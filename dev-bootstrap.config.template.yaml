# Global configuration for the ChainContest developer bootstrap CLI.
# Copy this file to `dev-bootstrap.config.yaml` and adjust values as needed.
version: "0.1.0"
projectName: "chaincontest-dev"

services:
  - name: "postgres"
    image: "postgres:16-alpine"
    command: ["postgres", "-c", "max_connections=200"]
    ports:
      - host: 5432
        container: 5432
    environment:
      POSTGRES_USER: "chaincontest"
      POSTGRES_PASSWORD: "chaincontest"
      POSTGRES_DB: "chaincontest"
    profiles:
      - "core"
    healthcheck:
      test: "CMD-SHELL pg_isready -U chaincontest"
      interval: "10s"
      timeout: "5s"
      retries: 5

  - name: "redis"
    image: "redis:7-alpine"
    command: ["redis-server", "--save", "", "--appendonly", "no"]
    ports:
      - host: 6379
        container: 6379
    profiles:
      - "core"
    healthcheck:
      test: "CMD-SHELL redis-cli ping"
      interval: "10s"
      timeout: "5s"
      retries: 5

  - name: "indexer"
    dockerfile: "infra/docker/indexer/Dockerfile"
    context: "."
    dependsOn:
      - "postgres"
      - "redis"
    profiles:
      - "indexer"

profiles:
  - key: "core"
    description: "Essential backing services required for API and UI development."
    defaultEnabled: true
    services:
      - "postgres"
      - "redis"

  - key: "indexer"
    description: "Indexer workloads for blockchain event processing."
    defaultEnabled: false
    services:
      - "indexer"

volumes:
  - name: "chaincontest-postgres"
    preserveOnReset: true
    description: "Persistent database volume for local development data."
  - name: "indexer-cache"
    preserveOnReset: false
    description: "Ephemeral cache for indexer worker outputs."

envFiles:
  - ".env"
  - ".env.local"

prerequisites:
  dockerVersion: "24.0.0"
  composeVersion: "2.24.0"
  cpuCores: 8
  memoryGb: 16
  portsInUse:
    - port: 5432
      description: "PostgreSQL database"
    - port: 6379
      description: "Redis cache"

logging:
  format: "table"
  retainComposeLogs: false

resetPolicy:
  mode: "selective"
  selectiveVolumes:
    - "indexer-cache"
