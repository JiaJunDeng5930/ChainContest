<!--
Sync Impact Report
Version change: [CONSTITUTION_VERSION] → 1.0.0
Modified principles:
- [PRINCIPLE_1_NAME] → I. 安全优先栈
- [PRINCIPLE_2_NAME] → II. 链上真相与全量事件
- [PRINCIPLE_3_NAME] → III. 去信任确定性执行
- [PRINCIPLE_4_NAME] → IV. 最小功能与最小权限
- [PRINCIPLE_5_NAME] → V. 可解释、可验证与性能守恒
Added sections: 工程与架构约束, 开发与验证流程
Removed sections: 无
Templates requiring updates:
- ✅ .specify/templates/plan-template.md
- ✅ .specify/templates/spec-template.md
- ✅ .specify/templates/tasks-template.md
- ⚠ .specify/templates/commands/ （目录缺失，需确认是否仍需该模板集）
Follow-up TODOs: 无
-->
# BC Constitution

## Core Principles

### I. 安全优先栈
- 安全 MUST 优先于正确性，正确性 MUST 优先于可用性，可用性 MUST 优先于成本；任何权衡必须沿此优先栈逐级论证。
- 系统 MUST 实现失败即回滚与 fail-closed 的异常处理，无法满足时必须拒绝上线。
- 每次变更 MUST 预设安全降级方案，保障在极端情况下也不触发链上不可逆损失。

Rationale: 链上资产一旦受损不可挽回，唯有严格的安全优先栈才能吸收不确定性。

### II. 链上真相与全量事件
- 链上状态与事件是唯一真相，所有链下视图 MUST 可重算并实时与链上校验。
- 每个状态转移 MUST 发出全量事件，确保第三方可重建完整时间线。
- 发现链上与链下任何偏差 MUST 立即冻结相关流程并进入可审计调查。

Rationale: 统一真相面消除争议与分叉，是实现去信任协作的前提。

### III. 去信任确定性执行
- 业务流程 MUST 去信任化：禁止依赖隐式信任主体或不透明服务。
- 执行路径 MUST 可重放、可预测且幂等；一旦失败必须切换回已知安全状态。
- 模块边界 MUST 显式声明输入、输出与不可变数据契约，禁止隐藏全局耦合。

Rationale: 可确定与可复算的执行模型是跨主体协作的基础，削减了信任攻击面。

### IV. 最小功能与最小权限
- 每项交付 MUST 以满足当前目标的最小功能集上线，延伸能力必须拆分为后续迭代。
- 权限、密钥与额度 MUST 最小化，并在入口前置否决条件以阻断危险请求。
- 对外接口 MUST 公开最小必要面并保持显式边界，禁止隐式共享凭证或后门。

Rationale: 最小化攻击面与职责区域，才能在快速上链的环境中实现安全降级。

### V. 可解释、可验证与性能守恒
- 所有决策与状态演进 MUST 可解释、可追溯且可独立验证。
- 测试策略 MUST 围绕用户旅程与关键属性，优先黑盒、回归与可复现场景。
- 热路径 MUST 保持轻量，重计算 MUST 分批处理且在入口前置否决以最小化上链数据，并支持渐进扩展。

Rationale: 透明与性能并行，确保系统在安全边界内仍具可用性与可扩展性。

## 工程与架构约束
- 代码 MUST 保持单一职责、显式边界与不可变优先；如需可变状态，必须提供完整回滚机制。
- 所有事件模式 MUST 提供全量上下文并纳入审计链，更新契约时须同步审查回放能力。
- 架构决策 MUST 直接改动核心抽象，禁止新增外层包装或临时胶水绕过既有边界。
- 决策流程 MUST 降低信任面：共享状态需可复算，禁止引入全局耦合或隐式依赖。
- 性能优化 MUST 在满足安全与确定性后进行，并记录可审计的性能假设与验证结果。

## 开发与验证流程
- 项目启动前 MUST 完成 Constitution Check：验证安全优先栈、链上真相、去信任执行、最小权限与可解释交付均可实现。
- 设计文档 MUST 指明链上真相来源、事件契约、失败回滚路径与降级策略。
- 任务分解 MUST 支持按旅程独立交付与验证，任何新功能若无法独立审计则不得进入迭代。
- 测试用例 MUST 覆盖关键旅程、属性与回归场景，并提供可复现指引。
- 性能与资源评估 MUST 在热路径确认轻量后再扩展，超出阈值时必须回滚或拆分方案。

## Governance
- 本宪法优先于其他流程文档；所有计划、设计、评审与发布 MUST 显式确认合规。
- 每个任务的核心变更完成后 MUST 立即执行自动化的原子化 commit；任何环境状态、第三方约束或个人判断均不得成为延迟或跳过 commit 的理由。
- 在任务清单（tasks.md）全部标记完成之前，提交状态 MUST 100% 对齐：所有改动均已通过上述原子化 commit 入库，不得存在悬挂的未提交差异或未跟踪文件。
- 修订流程：提出变更 → 撰写影响分析 → 获得多方（安全、协议、交付）书面批准 → 实施并记录迁移/回滚计划 → 更新版本号与日期。
- 版本号遵循 MAJOR.MINOR.PATCH：破坏性治理变更递增 MAJOR，新增原则或重大扩展递增 MINOR，非语义修饰递增 PATCH。
- 每个发布周期 MUST 进行合规复核，记录违反事项与补救路径；未通过复核的改动不得合入主分支。
- 守护者团队 MUST 保证宪法可公开审计，并维护链上/链下执行的一致性验证工具。

**Version**: 1.0.0 | **Ratified**: 2025-10-08 | **Last Amended**: 2025-10-08
